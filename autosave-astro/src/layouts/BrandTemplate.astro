---
/**
 * BrandTemplate — layout template for car brand pages.
 * Renders a full SEO-optimized page for a specific car brand.
 * Route: /car-ac/[brand] and /en/car-ac/[brand]
 */
import PageLayout from './PageLayout.astro';
import ProgrammaticHero from '../components/programmatic/ProgrammaticHero.astro';
import FAQSection from '../components/programmatic/FAQSection.astro';
import CTAWhatsApp from '../components/programmatic/CTAWhatsApp.astro';
import RelatedLinks from '../components/programmatic/RelatedLinks.astro';
import type { CarBrand } from '../data/car-brands';
import type { Language } from '../lib/i18n';
import { carBrands } from '../data/car-brands';

interface Props {
  brand: CarBrand;
  lang: Language;
}

const { brand, lang } = Astro.props;
const isAr = lang === 'ar';

const brandName = isAr ? brand.nameAr : brand.nameEn;

const pageTitle = isAr
  ? `إصلاح مكيف ${brandName} | اوتو سيف`
  : `${brandName} AC Repair | Auto Save`;

const pageDescription = isAr
  ? `متخصصون في إصلاح وصيانة مكيف سيارات ${brandName}. تشخيص دقيق، قطع غيار أصلية وبديلة، ضمان على الصيانة. احجز الآن.`
  : `Specialists in ${brandName} car AC repair and maintenance. Accurate diagnosis, OEM and aftermarket parts, service warranty. Book now.`;

const leakLaserKeywordsAr = [
  `تسريب فريون ${brandName}`,
  `كشف تسريب مكيف ${brandName}`,
  `فحص ليزر ${brandName}`,
  'فحص ليزر تسريب الفريون',
  'فحص ليزر لمكيف السيارة',
];

const leakLaserKeywordsEn = [
  `${brandName} refrigerant leak`,
  `${brandName} ac leak detection`,
  `laser leak test car ac ${brandName}`,
  'car ac laser inspection',
  'freon leak laser test',
];

const breadcrumbs = [
  { label: isAr ? 'الرئيسية' : 'Home', href: isAr ? '/' : '/en' },
  { label: isAr ? 'السيارات' : 'Car Brands', href: isAr ? '/car-ac' : '/en/car-ac' },
  { label: brandName },
];

const whatsappMessage = isAr
  ? `السلام عليكم، أريد إصلاح مكيف سيارة ${brandName}`
  : `Hi, I need AC repair for my ${brandName}`;

// Related brands (exclude current, same popularity first, pick 5)
const relatedBrands = carBrands
  .filter((b) => b.slug !== brand.slug)
  .sort((a, b) => {
    if (a.popularity === brand.popularity && b.popularity !== brand.popularity) return -1;
    if (b.popularity === brand.popularity && a.popularity !== brand.popularity) return 1;
    return 0;
  })
  .slice(0, 5)
  .map((b) => ({
    title: isAr ? `إصلاح مكيف ${b.nameAr}` : `${b.nameEn} AC Repair`,
    href: isAr ? `/car-ac/${b.slug}` : `/en/car-ac/${b.slug}`,
  }));
---

<PageLayout
  title={pageTitle}
  description={pageDescription}
  lang={lang}
  keywords={isAr
    ? [`مكيف ${brandName}`, `إصلاح مكيف ${brandName}`, `صيانة مكيف ${brandName}`, ...leakLaserKeywordsAr]
    : [`${brandName} ac repair`, `${brandName} ac service`, `${brandName} ac problems`, ...leakLaserKeywordsEn]
  }
>
  <ProgrammaticHero
    eyebrow={isAr ? `سيارات ${brandName}` : `${brandName} Vehicles`}
    title={isAr
      ? `إصلاح مكيف سيارات ${brandName}`
      : `${brandName} Car AC Repair`}
    description={isAr ? brand.generalIssuesAr : brand.generalIssuesEn}
    lang={lang}
    breadcrumbs={breadcrumbs}
  />

  {/* Models section */}
  <section class="py-20 lg:py-28" data-animate="fade-in-up">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-10 text-center">
        <span class="eyebrow-decorated text-sm font-semibold uppercase tracking-widest text-primary">
          {isAr ? 'الموديلات' : 'Models'}
        </span>
        <h2 class="mt-4 font-display text-2xl font-bold text-foreground sm:text-3xl">
          {isAr
            ? `موديلات ${brandName} التي نخدمها`
            : `${brandName} Models We Service`}
        </h2>
      </div>

      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {brand.models.map((model, index) => {
          const modelName = isAr ? model.nameAr : model.nameEn;
          const modelHref = brand.popularity === 'high'
            ? (isAr ? `/car-ac/${brand.slug}/${model.slug}` : `/en/car-ac/${brand.slug}/${model.slug}`)
            : undefined;
          const issues = isAr ? model.commonAcIssuesAr : model.commonAcIssuesEn;

          return (
            <div
              class="rounded-xl border border-border bg-card p-5 shadow-sm card-hover-lift border-t-2 border-t-primary/25 hover:border-t-primary/60"
              data-animate="fade-in-up"
              data-animate-delay={String((index + 1) * 100)}
            >
              <div class="flex items-center justify-between">
                <h3 class="font-display text-lg font-semibold text-foreground">
                  {modelHref ? (
                    <a href={modelHref} class="transition-colors hover:text-primary">
                      {brandName} {modelName}
                    </a>
                  ) : (
                    <span>{brandName} {modelName}</span>
                  )}
                </h3>
                <span class="text-xs text-muted-foreground">{model.years}</span>
              </div>
              <div class="mt-3">
                <p class="mb-2 text-sm font-medium text-muted-foreground">
                  {isAr ? 'مشاكل المكيف الشائعة:' : 'Common AC Issues:'}
                </p>
                <ul class="space-y-1">
                  {issues.map((issue) => (
                    <li class="flex items-start gap-2 text-sm text-foreground">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="14"
                        height="14"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="mt-0.5 shrink-0 text-primary"
                        aria-hidden="true"
                      >
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                      </svg>
                      {issue}
                    </li>
                  ))}
                </ul>
              </div>
              {modelHref && (
                <a
                  href={modelHref}
                  class="mt-4 inline-flex items-center gap-1 text-sm font-medium text-primary transition-colors hover:text-primary/80"
                >
                  {isAr ? 'تفاصيل أكثر' : 'More details'}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class:list={[lang === 'ar' ? 'rotate-180' : '']}
                    aria-hidden="true"
                  >
                    <polyline points="9 18 15 12 9 6" />
                  </svg>
                </a>
              )}
            </div>
          );
        })}
      </div>
    </div>
  </section>

  {/* FAQ */}
  {brand.faqs.length > 0 && (
    <div class="bg-secondary/40">
      <FAQSection
        faqs={brand.faqs}
        lang={lang}
        title={isAr
          ? `أسئلة شائعة عن مكيف ${brandName}`
          : `FAQ About ${brandName} AC`}
      />
    </div>
  )}

  {/* Related brands */}
  <RelatedLinks
    links={relatedBrands}
    lang={lang}
    title={isAr ? 'ماركات سيارات أخرى' : 'Other Car Brands'}
  />

  {/* CTA */}
  <CTAWhatsApp lang={lang} message={whatsappMessage} />
</PageLayout>
